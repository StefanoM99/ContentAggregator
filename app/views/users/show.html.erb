<%if user_signed_in? and not current_user.user?%>
  <div class="container" id="profiles">
    
  <%= render :partial => 'shared/header' %>
  
    <br><br><br><br><br>
    <div data-aos="fade-right">
    
      <h1 style='font-size:80px'><b>Elementi Segnalati:</b></h1>
      <br>
      <div class="dropdown">
        <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown">
          Content Filter
        </button>
        <ul class="dropdown-menu">
          <li><%= link_to "All", current_user, class: 'dropdown-item' %></li>
        
      
          <li><%= link_to "Reported Posts", reported_user_posts_path(@user), class: 'dropdown-item' %></li>
          
          <li><%= link_to "Reported Articles", reported_user_articles_path(@user), class: 'dropdown-item' %></li>
          
          <li><%= link_to "Reported Playlists", reported_user_playlists_path(@user), class: 'dropdown-item' %></li>
        </ul>
      </div>
      <br>
    
    <div class="row" id="reported_articles">
    <%@index = (SavedArticle.where(type: "ReportedArticle").distinct.pluck(:article_id))%>
      <%puts(@index)%>
      <% SavedArticle.where(type: "ReportedArticle",article_id:@index).each do |reported_article| %>
      <%if @index.include? reported_article.article_id%>
          <ul class="col-12 col-lg-4 col-sm-6">
            <li class="card" data-aos="flip-down">
              <%= render reported_article %>
            </li>
          </ul>
        <%end%>
        <%@index.delete(reported_article.article_id)%>  
        <% end %>
        <%@index = (SavedPlaylist.where(type: "ReportedPlaylist").distinct.pluck(:playlist_id))%>
        <% SavedPlaylist.where(type: "ReportedPlaylist",playlist_id:@index).each do |reported_playlist| %>
        <%if @index.include? reported_playlist.playlist_id%>
          <ul class="col-12 col-lg-4 col-sm-6">
            <li class="card" data-aos="flip-down">
              <%= render reported_playlist %>
            </li>
          </ul>
          <%end%>
          <%@index.delete(reported_playlist.playlist_id)%>  
        <% end %>
        <%@index = (SavedPost.where(type: "ReportedPost").distinct.pluck(:post_id))%>
        <% SavedPost.where(type: "ReportedPost",post_id:@index).each do |reported_post| %>
        <%if @index.include? reported_post.post_id%>
          <ul class="col-12 col-lg-4 col-sm-6">
            <li class="card" data-aos="flip-down">
              <%= render reported_post %>
            </li>
          </ul>
          <%end%>
          <%@index.delete(reported_post.post_id)%>  
        <% end %>
      </div>
    </div>
    
    
    <script>
      AOS.init();
    </script>
  </div>
<%else%>
<div class="container" id="profiles">

  <%= render :partial => 'shared/header' %>

  <br><br><br><br>
  <div data-aos="fade-right">

    <% if current_user && current_user.id.to_i == params[:id].to_i %>
      <div style="text-align:center">
        <% if (current_user.avatar_url == nil) or (current_user.avatar_url == "") %>
          <%= image_tag "https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png", class:"propic" %>
        <% else %>
          <%= image_tag current_user.avatar_url, class:"propic" %>
        <% end %>
        <h1 style='font-size:80px'><b>Ciao <%=current_user.full_name%></b></h1>
      </div>
    <%else%>
      <div style="text-align:center">
        <% if User.find(params[:id].to_i).avatar_url == nil or User.find(params[:id].to_i).avatar_url == "" %>
          <%= image_tag "https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_960_720.png", class:"propic" %>
        <% else %>
          <%= image_tag User.find(params[:id].to_i).avatar_url, class:"propic" %>
        <% end %>
        <h1 style='font-size:80px'><b> <%=User.find(params[:id].to_i).name + " " + User.find(params[:id].to_i).surname%></b></h1>
        <div>
          <% if user_signed_in? %>
            <% if current_user.followees.include?(@user) %>
              <h5><%= button_to "Seguito", unfollow_user_path, method: "POST", class: "btn btn-success" %></h5>
            <% else %>
              <h5><%= button_to "Segui", follow_user_path, method: "POST", class: "btn btn-secondary"  %></h5>
            <% end %>
          <% end %>
        </div>
      </div>
    <%end%>
    <p style="color: green"><%= notice %></p>
    <p style="color: red"><%= alert %></p>
    <div data-aos="fade-right"  style="text-align:center">
      <br>
      <div class="dropdown">
        <button type="button" class="btn btn-secondary dropdown-toggle" data-bs-toggle="dropdown">
          Filtro Contenuti
        </button>
        <ul class="dropdown-menu">
          <li><%= link_to "Tutto", user_path(@user), class: 'dropdown-item' %></li>
          <li><%= link_to "I tuoi Post", user_posts_path(@user), class: 'dropdown-item' %></li>
          <li><%= link_to "Post Modificati", edited_user_posts_path(@user), class: 'dropdown-item' %></li>
          <li><%= link_to "Post Salvati", starred_user_posts_path(@user), class: 'dropdown-item' %></li>
          <li><%= link_to "Post Segnalati", reported_user_posts_path(@user), class: 'dropdown-item' %></li>
          <li><%= link_to "Articoli Salvati", starred_user_articles_path(@user), class: 'dropdown-item' %></li>
          <li><%= link_to "Articoli Segnalati", reported_user_articles_path(@user), class: 'dropdown-item' %></li>
          <li><%= link_to "Playlist Salvate", starred_user_playlists_path(@user), class: 'dropdown-item' %></li>
          <li><%= link_to "Playlist Segnalate", reported_user_playlists_path(@user), class: 'dropdown-item' %></li>
        </ul>
      </div>
      <br>
    
      <div class="row" id="reported_articles">
        <% if SavedArticle.where(user_id: params[:id],type: "ReportedArticle").exists?%>
          <h1 style='font-size:40px'> Articoli Segnalati:</h1> <br>
        <%end%>
        
        <% SavedArticle.where(user_id: params[:id],type: "ReportedArticle").each do |reported_article| %>
          <ul class="col-12 col-lg-4 col-sm-6">
            <li class="card" data-aos="flip-down">
              <%= render reported_article %>
            </li>
          </ul>
        <% end %>
        <br>
        <% if SavedPlaylist.where(user_id: params[:id],type: "ReportedPlaylist").exists?%>
          <h1 style='font-size:40px'> Playlist Segnalate:</h1> <br>
        <%end%>
        
        <% SavedPlaylist.where(user_id: params[:id],type: "ReportedPlaylist").each do |reported_playlist| %>
          <ul class="col-12 col-lg-4 col-sm-6">
            <li class="card" data-aos="flip-down">
              <%= render reported_playlist %>
            </li>
          </ul>
        <% end %>
        
        <% if SavedPost.where(user_id: params[:id],type: "ReportedPost").exists?%>
          <h1 style='font-size:40px'> Post Segnalati:</h1> <br>
        <%end%>
        
        <% SavedPost.where(user_id: params[:id],type: "ReportedPost").each do |reported_post| %>
          <ul class="col-12 col-lg-4 col-sm-6">
            <li class="card" data-aos="flip-down">
              <%= render reported_post %>
            </li>
          </ul>
        <% end %>
        
        <% if SavedArticle.where(user_id: params[:id],type: "StarredArticle").exists?%>
          <h1 style='font-size:40px'> Articoli Salvati:</h1> <br>
        <%end%>
        
        <% SavedArticle.where(user_id: params[:id],type: "StarredArticle").each do |starred_article| %>
          <ul class="col-12 col-lg-4 col-sm-6">
            <li class="card" data-aos="flip-down">
              <%= render starred_article %>
            </li>
          </ul>
        <% end %>
        
        <% if SavedPlaylist.where(user_id: params[:id],type: "StarredPlaylist").exists?%>
          <h1 style='font-size:40px'> Playlists Salvate:</h1> <br>
        <%end%>
        
        <% SavedPlaylist.where(user_id: params[:id],type: "StarredPlaylist").each do |starred_playlist| %>
          <ul class="col-12 col-lg-4 col-sm-6">
            <li class="card" data-aos="flip-down">
              <%= render starred_playlist %>
            </li>
          </ul>
        <% end %>
        
        <% if SavedPost.where(user_id: params[:id],type: "StarredPost").exists?%>
          <h1 style='font-size:40px'> Post Salvati:</h1> <br>
        <%end%>
        
        <% SavedPost.where(user_id: params[:id],type: "StarredPost").each do |starred_post| %>
          <ul class="col-12 col-lg-4 col-sm-6">
            <li class="card" data-aos="flip-down">
              <%= render starred_post %>
            </li>
          </ul>
        <% end %>
        
        <% if SavedPost.where(user_id: params[:id],type: "EditedPost").exists?%>
          <h1 style='font-size:40px'> Post Editati:</h1> <br>
        <%end%>
        
        <% SavedPost.where(user_id: params[:id],type: "EditedPost").each do |edited_post| %>
          <ul class="col-12 col-lg-4 col-sm-6">
            <li class="card" data-aos="flip-down">
              <%= render edited_post %>
            </li>
          </ul>
        <% end %>

        <% if Post.where(user_id: params[:id]).exists?%>
          <h1 style='font-size:40px'> I tuoi post:</h1> <br>
        <%end%>

        <% Post.where(user_id: params[:id]).each do |my_post| %>
          <ul class="col-12 col-lg-4 col-sm-6">
            <li class="card" data-aos="flip-down">
              <%= render my_post %>
            </li>
          </ul>
        <% end %>
      </div>
    </div>
  </div>
  
  <script>
    AOS.init();
  </script>
</div>
<%end%>