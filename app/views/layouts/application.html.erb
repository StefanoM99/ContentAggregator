<!DOCTYPE html>
<html>
    <head>
        <title>ContentAggregator</title>
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <%= csrf_meta_tags %>
        <%= csp_meta_tag %>
        <%= stylesheet_link_tag "main" %>
        <%= stylesheet_link_tag "application.js", "data-turbo-track": "reload" %>
        <% javascript_include_tag "application" %>
        <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
        <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>
        <!-- jQuery -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    </head>

    <body>
        <%= yield %>
        <!-- Se si è loggati e non si è in una delle seguenti pagine... -->
        <% if user_signed_in? and not (current_page?('/pages/help') or current_page?('/pages/account') or current_page?('/pages/profile') or current_page?('/pages/info') or current_page?('/pages/users') or current_page?('/pages/contacts') or current_page?('/') or current_page?('/home') or current_page?('/users/sign_in')) %> <!-- TODO: aggiungere i controlli delle altre pagine -->
            <%= render :partial => 'shared/help_button' %>
        <% end %>
        <!-- SCRIPT: al click del bottone "ACCOUNT" rimuove l'event listener del bottone "Help!" e sostituisce il contenuto del body del modal con la pagina /pages/account -->
        <script>
        $(document).ready(function(){

            $("#accountBtn").on("click", function(){
                //$("#helpBtn").unbind("click");
                $.get("/pages/account", function(data){
                    $("#helpDiv").replaceWith(data);
                });
            });
            
            $("#profileBtn").on("click", function(){
                $.get("/pages/profile", function(data){
                    $("#helpDiv").replaceWith(data);
                });
            });

            $("#infoBtn").on("click", function(){
                $.get("/pages/info", function(data){
                    $("#helpDiv").replaceWith(data);
                });
            });

            /*$("#usersBtn").on("click", function(){
                $.get("/pages/users", function(data){
                    $("#helpDiv").replaceWith(data);
                });
            });*/

            $("#contactsBtn").on("click", function(){
                $.get("/pages/contacts", function(data){
                    $("#helpDiv").replaceWith(data);
                });
            });

            $("#backBtn").on("click", function(){
                //$("#help-btn").unbind("click");
                //$("#account-btn").unbind("click");
                $.get("/pages/help", function(data){
                    $("#helpDiv").replaceWith(data);
                });
            });

        });

        $(document).on('click', '#starred', function () { 
        console.log("ciao")
        
            console.log( $(this).parents('form:first'))
            $(this).parents('form:first').submit()
            $(this).replaceWith(" <button disabled class = 'buttonclassdis'>Salva</button>");
        });

        $(document).on('click', '#reported', function () { 
        console.log("ciao")
        
            console.log( $(this).parents('form:first'))
            $(this).parents('form:first').submit()
            $(this).replaceWith(" <button disabled class = 'buttonclassdis'>Segnala</button>");
        });
        </script>
    </body>
</html>
