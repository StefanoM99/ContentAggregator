<!DOCTYPE html>
<html>
  <head>
    <head>
    <title>ContentAggregator</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "main" %>
    <%= stylesheet_link_tag "application.js", "data-turbo-track": "reload" %>
    <%= javascript_include_tag "/assets/application.js", "data-turbo-track": "reload", defer: true %>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
  </head>

  <body>
  <% if user_signed_in? and not (current_page?('/pages/help') or current_page?('/pages/account') or current_page?('/pages/profile') or current_page?('/pages/posts') or current_page?('/pages/users') or current_page?('/pages/contacts') or current_page?('/') or current_page?('/home') or current_page?('/users/sign_in')) %>
Logged in as <%= current_user.email%> [<%= link_to 'Logout',
destroy_user_session_path, :method => :delete%>]
<% end %>
    <%= yield %>
    <!-- Se non sono in una delle seguenti pagine costruisco bottone e modal -->
    <% if not (current_page?('/pages/help') or current_page?('/pages/account') or current_page?('/pages/profile') or current_page?('/pages/posts') or current_page?('/pages/users') or current_page?('/pages/contacts') or current_page?('/') or current_page?('/home') or current_page?('/users/sign_in')) %> <!-- TODO: aggiungere i controlli delle altre pagine -->
    <!-- Button trigger modal -->
    <button type="button" id="helpBtn" class="btn btn-primary rounded-pill position-fixed bottom-0 end-0 m-3" data-bs-toggle="modal" data-bs-target="#helpModal">
    Help!
    </button>
    <!-- Modal -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-fullscreen-sm-down">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="helpModalLabel">How can I help you?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div id="helpModalBody" class="modal-body">
                    <div id="helpDiv">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item active" aria-current="page">Help</li>
                            </ol>
                        </nav>
                        <p class="line-1 anim-typewriter font-monospace pt-6">Hi! How can I help you? :)</p>
                        <ul class="list-group list-group-flush text-center font-monospace">
                            <li id="accountBtn" class="list-group-item">
                                <p class="btn btn-link m-1">ACCOUNT</p>
                            </li>
                            <li id="profileBtn" class="list-group-item">
                                <p class="btn btn-link m-1">PROFILE</p>
                            </li>
                            <li id="postsBtn" class="list-group-item">
                                <p class="btn btn-link m-1">POSTS</p>
                            </li>
                            <li id="usersBtn" class="list-group-item">
                                <p class="btn btn-link m-1">USERS</p>
                            </li>
                            <li id="contactsBtn" class="list-group-item">
                                <p class="btn btn-link m-1">CONTACTS</p>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <% end %>
    <!-- SCRIPT: al click del bottone "ACCOUNT" rimuove l'event listener del bottone "Help!" e sostituisce il contenuto del body del modal con la pagina /pages/account -->
    <script>
    $(document).ready(function(){

        $("#accountBtn").on("click", function(){
            //$("#helpBtn").unbind("click");
            $.get("/pages/account", function(data){
                $("#helpDiv").replaceWith(data);
            });
        });
        
        $("#profileBtn").on("click", function(){
            $.get("/pages/profile", function(data){
                $("#helpDiv").replaceWith(data);
            });
        });

        $("#postsBtn").on("click", function(){
            $.get("/pages/posts", function(data){
                $("#helpDiv").replaceWith(data);
            });
        });

        $("#usersBtn").on("click", function(){
            $.get("/pages/users", function(data){
                $("#helpDiv").replaceWith(data);
            });
        });

        $("#contactsBtn").on("click", function(){
            $.get("/pages/contacts", function(data){
                $("#helpDiv").replaceWith(data);
            });
        });

        $("#backBtn").on("click", function(){
            //$("#help-btn").unbind("click");
            //$("#account-btn").unbind("click");
            $.get("/pages/help", function(data){
                $("#helpDiv").replaceWith(data);
            });
        });

    });
    </script>
    
  </body>
</html>
